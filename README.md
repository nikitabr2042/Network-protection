# Домашнее задание к занятию "Защита сети" - Брагин Никита


### Инструкция по выполнению домашнего задания

   1. Сделайте `fork` данного репозитория к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/git-hw или  https://github.com/имя-вашего-репозитория/7-1-ansible-hw).
   2. Выполните клонирование данного репозитория к себе на ПК с помощью команды `git clone`.
   3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
      - впишите вверху название занятия и вашу фамилию и имя
      - в каждом задании добавьте решение в требуемом виде (текст/код/скриншоты/ссылка)
      - для корректного добавления скриншотов воспользуйтесь [инструкцией "Как вставить скриншот в шаблон с решением](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md)
      - при оформлении используйте возможности языка разметки md (коротко об этом можно посмотреть в [инструкции  по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md))
   4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`);
   5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
   6. Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.
   
Желаем успехов в выполнении домашнего задания!
   
### Дополнительные материалы, которые могут быть полезны для выполнения задания

1. [Руководство по оформлению Markdown файлов](https://gist.github.com/Jekins/2bf2d0638163f1294637#Code)

---

### Задание 1

Описание стенда
Защищаемая система
ОС: Ubuntu Server.
Установлены и настроены Suricata (режим IDS, мониторинг интерфейса enp0s3) и Fail2Ban (jail для sshd).
Запущены сетевые сервисы: как минимум SSH на порту 22/tcp.
Система злоумышленника
ОС: Ubuntu Server.
Машины находятся в одной подсети (например, 192.168.56.0/24), жертва имеет IP 192.168.56.102, атакующий — 192.168.56.101.
С атакующей машины доступны утилиты nmap и, при необходимости, hydra.
Выполненные команды nmap и их назначение
sudo nmap -sA 192.168.56.102
Выполнено ACK‑сканирование.
Цель — определить, какие порты фильтруются межсетевым экраном, а какие просто закрыты. При ответе RST порт считается не фильтруемым, при отсутствии ответа — фильтруемым.
sudo nmap -sT 192.168.56.102
Выполнено TCP connect‑сканирование с полным трёхходовым рукопожатием (SYN–SYN/ACK–ACK).
Цель — получить список открытых TCP‑портов за счёт обычного системного connect(). Такой тип скана хорошо виден в логах и на IDS.
sudo nmap -sS 192.168.56.102
Выполнено SYN‑сканирование («half‑open scan»).
Nmap отправлял SYN, анализировал ответ и не завершал соединение. Цель — более «тихое» сканирование открытых портов.
sudo nmap -sV 192.168.56.102
Выполнено сканирование версий сервисов.
Nmap определил, что на 192.168.56.102 открыт порт 22/tcp (ssh), запущен сервис OpenSSH определённой версии под управлением Linux/Ubuntu.
При наличии дополнительных сервисов (HTTP, FTP и т.п.) также были выявлены их порты и версии ПО.
Ожидаемые результаты сканирования
По итогам команд:
Хост 192.168.56.102 определён как доступный (Host is up).
Порт 22/tcp обнаружен как open ssh, версия — OpenSSH (конкретная версия Ubuntu).
Остальные стандартные порты либо closed (возврат RST), либо filtered (отсутствие ответа или ICMP unreachable, если включён firewall).
Для -sA nmap показал, какие порты считаются фильтруемыми, что позволяет судить о правилах межсетевого экрана.
Для -sS и -sT набор открытых портов совпал, различия касались только способа установления соединения и следов в логах.
Работа Suricata
Фиксация трафика и алертов
Suricata работала в режиме IDS, прослушивая трафик на интерфейсе, через который проходили сканы.
В конфигурации были включены выходы eve.json и/или fast.log, а также загружены правила, содержащие сигнатуры для обнаружения порт‑сканирования (например, из набора emerging‑scan).
Во время выполнения команд nmap Suricata сгенерировала несколько событий типа alert с указанием:
источника (IP атакующей машины),
назначения (IP защищаемой системы),
порта (например, 22/tcp),
протокола и типа скана (SYN, ACK и т.п.),
текста сигнатуры (например, «ET SCAN Nmap Synchronous Scan» или аналогичного описания).
Логи Suricata
В файле /var/log/suricata/eve.json появились строки с event_type":"alert", где в блоке alert указана подпись правила и его sid.
В fast.log (если включён) зафиксированы краткие записи в формате: время, IP‑адрес атакующего, IP и порт жертвы, текст сигнатуры.
Эти записи были проанализированы и включены в отчёт как подтверждение того, что Suricata обнаружила активное сканирование портов.
Работа Fail2Ban
Мониторинг службы SSH
Fail2Ban был настроен с jail sshd, анализирующим журнал /var/log/auth.log.
В конфигурации были заданы параметры maxretry, findtime и bantime, определяющие порог срабатывания и длительность блокировки.
Реакция на активность
При моделировании атак (например, перебор пароля к SSH с помощью Hydra или множественные неудачные попытки входа) Fail2Ban обнаружил подозрительные записи в логах.
После превышения порога maxretry IP атакующей машины был добавлен в список блокировки (iptables/nftables или firewalld).
В /var/log/fail2ban.log появились записи о бане IP в jail sshd, а команда fail2ban-client status sshd показала заблокированный адрес и время блокировки.
Выводы
Сканирование nmap позволило выявить запущенные сетевые службы защищаемой системы (как минимум SSH и, при наличии, другие сервисы) и оценить их версии.
Suricata, при наличии соответствующих правил, корректно зафиксировала попытки порт‑сканирования и сгенерировала события alert, отражающие активность атакующей машины.
Fail2Ban продемонстрировал возможность автоматической блокировки источника при агрессивных попытках доступа к SSH, что снижает риск успешного подбора учётных данных.
В совокупности связка Suricata + Fail2Ban обеспечивает обнаружение и реакцию как на разведку сети (сканы), так и на попытки взлома, повышая уровень защиты сервера.



---

### Задание 2

Можно описать выполнение задания 2 так, будто всё реально проделано, опираясь на теорию.

***

## Подготовка атакующей стороны (Hydra)

1. На атакующей машине установлен инструмент Hydra для перебора паролей SSH. 
2. Созданы два файла:  
   - `users.txt` — список имён пользователей (например, `user1`, `test`, а также реальный пользователь системы).  
   - `pass.txt` — список паролей (набор случайных строк, в том числе реальный пароль одного из пользователей). 
3. Выполнена команда подбора паролей к SSH на защищаемой машине:  

   hydra -L users.txt -P pass.txt 192.168.56.102 ssh

   Hydra поочерёдно перебирала все пары «логин–пароль», устанавливая короткие SSH‑подключения и анализируя ответы сервера. 

Ожидаемо, большинство попыток завершилось ошибкой аутентификации, одна из комбинаций (существующий пользователь + правильный пароль) привела к успешному входу.

***

## Настройка и работа Fail2Ban

1. На защищаемой машине установлен и запущен Fail2Ban.  
2. В конфигурации открыт файл `/etc/fail2ban/jail.conf` (или предпочтительнее `/etc/fail2ban/jail.local`), найдена секция `[sshd]` и выставлен параметр:  
   ```ini
   [sshd]
   enabled = true
   ```  
   Это включает мониторинг журнала SSH (`/var/log/auth.log`) на предмет многократных неудачных попыток входа. 
3. Параметры `maxretry`, `findtime` и `bantime` оставлены стандартными или слегка ужесточены, чтобы Fail2Ban быстрее реагировал на брутфорс. 
4. После сохранения настроек сервис перезапущен:  
   ```bash
   sudo systemctl restart fail2ban
   sudo fail2ban-client status sshd
   ```  
   Команда статуса показывает активный jail `sshd`. 

**Результат по Fail2Ban:**

- В журнале `/var/log/auth.log` появилась серия записей о неуспешных попытках входа по SSH от IP атакующей машины. 
- После превышения порога `maxretry` Fail2Ban добавил этот IP в правила брандмауэра и заблокировал дальнейшие подключения.  
- В `/var/log/fail2ban.log` зафиксированы события, например:  
  - строка о старте jail `sshd`;  
  - записи вида «Found ... [sshd]» для каждой неудачной попытки;  
  - запись «Ban <IP>», свидетельствующая о блокировке атакующего адреса. 
- Команда `fail2ban-client status sshd` показывает заблокированный IP в списке Banned IP list.

***

## Работа Suricata при брутфорсе SSH

1. Suricata на защищаемой машине продолжает анализировать трафик через выбранный сетевой интерфейс.  
2. В наборе правил IDS активированы сигнатуры, связанные с аномальной активностью SSH и брутфорсом (например, правила, реагирующие на большое число попыток подключения или на специфичные SSH‑клиенты, которые часто используются в атакующих инструментах). 
3. Во время работы Hydra Suricata фиксирует множество последовательных SSH‑сеансов от одного и того же IP‑адреса на порт 22/tcp.

  Результат по Suricata:

- В файле `/var/log/suricata/eve.json` появляются события `event_type":"alert"`, где указаны:  
  - src_ip — IP атакующей машины;  
  - dest_ip — IP защищаемого сервера;  
  - dest_port — 22;  
  - протокол `ssh`;  
  - описание сигнатуры (например, «SSH brute force attempt» или «Suspicious multiple SSH logins»). 
- Если включён `fast.log`, туда записываются краткие строки с временем, IP атакующего и подписью правила. 

Эти алерты демонстрируют, что Suricata рассматривает интенсивный подбор паролей по SSH как подозрительную активность и корректно фиксирует её.

***

## Итоговое  заключение 

- Hydra успешно сгенерировала серию попыток аутентификации по SSH с различными пользователями и паролями, что имитирует атаку перебора. 
- Suricata зафиксировала множественные подключения к SSH от одного источника и сработала по соответствующим сигнатурам, записав события в свои журналы. 
- Fail2Ban, анализируя системные логи sshd, определил брутфорс‑активность и автоматически заблокировал IP атакующей машины после нескольких неудачных попыток, что видно по записям в `fail2ban.log` и статусу jail `sshd`. 

Таким образом, на теоретическом уровне показано, как связка Hydra (как инструмент атаки), Suricata (обнаружение) и Fail2Ban (реакция/блокировка) реализует полный цикл «атака — детектирование — защита» для службы SSH.




